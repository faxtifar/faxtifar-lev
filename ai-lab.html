<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –õ–∞–± - –ü–æ–º–æ—â–Ω–∏–∫ –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow-x: hidden; min-height: 100vh; }
        .particles-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; overflow: hidden; }
        .particle { position: absolute; width: 4px; height: 4px; background: radial-gradient(circle, #60a5fa, #3b82f6); border-radius: 50%; opacity: 0.6; animation: fall linear infinite; box-shadow: 0 0 10px rgba(96, 165, 250, 0.8); }
        @keyframes fall { to { transform: translateY(100vh) translateX(var(--tx)); opacity: 0; } }
        .content { position: relative; z-index: 10; }
        nav { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(96, 165, 250, 0.2); position: sticky; top: 0; z-index: 100; padding: 1rem 2rem; }
        .nav-container { max-width: 6xl; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-size: 1.5rem; font-weight: 900; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none; cursor: pointer; }
        .nav-links { display: flex; gap: 2rem; }
        .nav-links a { color: #cbd5e1; text-decoration: none; transition: color 0.3s ease; }
        .nav-links a:hover { color: #60a5fa; }
        @media (max-width: 768px) { .nav-links { display: none; } }
        .ai-lab-container { max-width: 1200px; margin: 0 auto; padding: 2rem; min-height: calc(100vh - 80px); display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .ai-info { background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.1)); border: 2px solid rgba(96, 165, 250, 0.3); border-radius: 15px; padding: 2rem; height: fit-content; position: sticky; top: 100px; }
        .ai-info h2 { font-size: 1.8rem; margin-bottom: 1rem; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .ai-info p { color: #cbd5e1; line-height: 1.8; margin-bottom: 1rem; font-size: 0.95rem; }
        .chat-container { background: linear-gradient(135deg, rgba(96, 165, 250, 0.05), rgba(167, 139, 250, 0.05)); border: 2px solid rgba(96, 165, 250, 0.3); border-radius: 15px; display: flex; flex-direction: column; height: 600px; overflow: hidden; }
        .chat-header { background: linear-gradient(135deg, rgba(96, 165, 250, 0.2), rgba(167, 139, 250, 0.2)); border-bottom: 1px solid rgba(96, 165, 250, 0.3); padding: 1.5rem; text-align: center; }
        .chat-header h3 { font-size: 1.3rem; color: #60a5fa; margin-bottom: 0.5rem; }
        .chat-header p { font-size: 0.85rem; color: #cbd5e1; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
        .message { display: flex; gap: 0.75rem; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { justify-content: flex-end; }
        .message-avatar { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0; }
        .message.ai .message-avatar { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
        .message.user .message-avatar { background: linear-gradient(135deg, #a78bfa, #ec4899); }
        .message-content { max-width: 70%; padding: 0.75rem 1rem; border-radius: 10px; font-size: 0.95rem; line-height: 1.5; word-wrap: break-word; }
        .message.ai .message-content { background: rgba(96, 165, 250, 0.2); border: 1px solid rgba(96, 165, 250, 0.3); color: #cbd5e1; }
        .message.user .message-content { background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(167, 139, 250, 0.3)); border: 1px solid rgba(96, 165, 250, 0.5); color: #e2e8f0; }
        .message-content code { background: rgba(0, 0, 0, 0.3); padding: 0.2rem 0.4rem; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.9em; }
        .message-content pre { background: rgba(0, 0, 0, 0.5); padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 0.5rem 0; }
        .message-content pre code { background: none; padding: 0; color: #e2e8f0; }
        .message-content strong { color: #60a5fa; font-weight: 600; }
        .message-content ul, .message-content ol { margin-left: 1.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
        .message-content li { margin-bottom: 0.25rem; }
        .message-image { max-width: 200px; border-radius: 8px; margin-top: 0.5rem; }
        .chat-input-area { border-top: 1px solid rgba(96, 165, 250, 0.3); padding: 1rem; background: rgba(15, 23, 42, 0.5); display: flex; gap: 0.75rem; align-items: flex-end; flex-wrap: wrap; }
        .chat-input { flex: 1; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(96, 165, 250, 0.3); color: #e2e8f0; padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.95rem; transition: all 0.3s ease; resize: none; max-height: 100px; font-family: inherit; min-width: 200px; }
        .chat-input:focus { outline: none; border-color: rgba(96, 165, 250, 0.8); box-shadow: 0 0 15px rgba(96, 165, 250, 0.3); }
        .send-btn, .image-btn { background: linear-gradient(135deg, #60a5fa, #3b82f6); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; }
        .send-btn:hover, .image-btn:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(96, 165, 250, 0.5); }
        .send-btn:disabled, .image-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .image-btn { background: linear-gradient(135deg, #a78bfa, #ec4899); }
        .image-btn:hover { box-shadow: 0 0 20px rgba(167, 139, 250, 0.5); }
        #imageInput { display: none; }
        .backend-status { font-size: 0.8rem; color: #64748b; margin-top: 1rem; padding: 0.75rem; background: rgba(96, 165, 250, 0.1); border-radius: 8px; }
        .backend-status.connected { color: #10b981; border-left: 3px solid #10b981; }
        .backend-status.disconnected { color: #ef4444; border-left: 3px solid #ef4444; }
        @media (max-width: 1024px) { .ai-lab-container { grid-template-columns: 1fr; } .ai-info { position: static; } .chat-container { height: 500px; } .message-content { max-width: 90%; } }
        .chat-messages::-webkit-scrollbar { width: 8px; }
        .chat-messages::-webkit-scrollbar-track { background: rgba(96, 165, 250, 0.1); border-radius: 10px; }
        .chat-messages::-webkit-scrollbar-thumb { background: rgba(96, 165, 250, 0.3); border-radius: 10px; }
        .chat-messages::-webkit-scrollbar-thumb:hover { background: rgba(96, 165, 250, 0.5); }
        .typing-indicator { display: flex; gap: 4px; padding: 0.75rem 1rem; }
        .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: #60a5fa; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { opacity: 0.3; transform: translateY(0); } 30% { opacity: 1; transform: translateY(-10px); } }
    </style>
</head>
<body>
    <div class="particles-container" id="particlesContainer"></div>
    <div class="content">
        <nav>
            <div class="nav-container">
                <a href="index.html" class="nav-logo">Faxtifar</a>
                <div class="nav-links hidden md:flex">
                    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="index.html#skills">–ù–∞–≤—ã–∫–∏</a>
                    <a href="index.html#game">–ò–≥—Ä–∞</a>
                    <a href="index.html#about">–û–±–æ –º–Ω–µ</a>
                    <a href="ai-lab.html" style="color: #60a5fa;">AI –õ–∞–±</a>
                </div>
            </div>
        </nav>
        <div class="ai-lab-container">
            <div class="ai-info">
                <h2>ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫</h2>
                <p>–Ø –ø–æ–º–Ω—é –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –Ω–∞—à–µ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∏ –¥–∞—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.</p>
                <p style="margin-top: 1.5rem; font-size: 0.85rem; color: #64748b;">üí° –°–ø—Ä–∞—à–∏–≤–∞–π –æ –ª—é–±—ã—Ö —è–∑—ã–∫–∞—Ö: Python, JavaScript, HTML/CSS, Java, C++, Go –∏ —Ç.–¥.</p>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #64748b;">‚ö° –Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –∫–æ–¥–∏–Ω–≥–æ–º, –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –æ—à–∏–±–æ–∫!</p>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #64748b;">üöÄ –°–ø—Ä–∞—à–∏–≤–∞–π —á—Ç–æ —É–≥–æ–¥–Ω–æ - —è –æ—Ç–≤–µ—á—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!</p>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #64748b;">üì∏ –ú–æ–∂–µ—à—å –ø—Ä–∏—Å–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞, –∏ —è –ø–æ–º–æ–≥—É –µ–≥–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å!</p>
                <div class="backend-status" id="backendStatus">üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
            </div>
            <div class="chat-container">
                <div class="chat-header">
                    <h3>üí¨ –ß–∞—Ç —Å –£–º–Ω—ã–º –ò–ò</h3>
                    <p>–ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π AI –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. üëã –Ø –∑–Ω–∞—é Python, JavaScript, HTML/CSS, Java, C++, Go –∏ –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏. –°–ø—Ä–∞—à–∏–≤–∞–π —á—Ç–æ —É–≥–æ–¥–Ω–æ ‚Äî —è –¥–∞–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞! üöÄ</div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <textarea class="chat-input" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å..." rows="1"></textarea>
                    <button class="image-btn" id="imageBtn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"><i class="fas fa-image"></i></button>
                    <button class="send-btn" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
                    <input type="file" id="imageInput" accept="image/*">
                </div>
            </div>
        </div>
    </div>
    <script>
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const imageBtn = document.getElementById('imageBtn');
        const imageInput = document.getElementById('imageInput');
        const backendStatus = document.getElementById('backendStatus');
        
        let conversationHistory = [];
        let selectedImage = null;
        let backendUrl = 'https://faxtifar-ai-backend.onrender.com'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
        let isBackendConnected = false;

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–¥–∞—é—â–∏—Ö —á–∞—Å—Ç–∏—Ü
        function createParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 50;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const duration = Math.random() * 10 + 20;
                const delay = Math.random() * 5;
                const tx = (Math.random() - 0.5) * 100;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = '-10px';
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.animation = `fall ${duration}s linear ${delay}s infinite`;
                container.appendChild(particle);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—ç–∫–µ–Ω–¥—É
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${backendUrl}/docs`);
                if (response.ok) {
                    isBackendConnected = true;
                    backendStatus.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É AI (GPT-4o-mini)';
                    backendStatus.classList.add('connected');
                    backendStatus.classList.remove('disconnected');
                } else {
                    throw new Error('Backend not responding');
                }
            } catch (error) {
                console.log('Backend not available, using local responses');
                isBackendConnected = false;
                backendStatus.textContent = '‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–±—ç–∫–µ–Ω–¥ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω)';
                backendStatus.classList.add('disconnected');
                backendStatus.classList.remove('connected');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessage(text, isUser, imageUrl = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? 'üë§' : 'ü§ñ';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Markdown-–ø–æ–¥–æ–±–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/`(.*?)`/g, '<code>$1</code>');
            text = text.replace(/\n/g, '<br>');
            
            content.innerHTML = text;
            
            if (imageUrl) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.className = 'message-image';
                content.appendChild(img);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Highlight –∫–æ–¥–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            content.querySelectorAll('code').forEach(block => {
                if (block.parentElement.tagName === 'PRE') {
                    hljs.highlightElement(block);
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–µ—á–∞—Ç–∏
        function showTypingIndicator() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            messageDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';
            
            const content = document.createElement('div');
            content.className = 'typing-indicator';
            content.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–µ—á–∞—Ç–∏
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥
        async function sendToBackend(message, imageData) {
            try {
                const payload = {
                    message: message,
                    history: conversationHistory,
                    image_data: imageData || null
                };
                
                const response = await fetch(`${backendUrl}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Error calling backend:', error);
                return null;
            }
        }

        // –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
        const knowledgeBase = {
            'python': 'Python ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–≤–æ–µ–π –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é. –í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:\n\n**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**\n```python\nname = "Faxtifar"\nage = 25\nheight = 1.75\nis_developer = True\n```\n\n**–§—É–Ω–∫—Ü–∏–∏:**\n```python\ndef greet(name):\n    return f"–ü—Ä–∏–≤–µ—Ç, {name}!"\n```\n\n**–¶–∏–∫–ª—ã:**\n```python\nfor i in range(5):\n    print(f"–ò—Ç–µ—Ä–∞—Ü–∏—è {i}")\n```',
            'javascript': 'JavaScript ‚Äî —è–∑—ã–∫ –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.\n\n**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**\n```javascript\nlet name = "Faxtifar";\nconst age = 25;\n```\n\n**–§—É–Ω–∫—Ü–∏–∏:**\n```javascript\nfunction greet(name) {\n    return `–ü—Ä–∏–≤–µ—Ç, ${name}!`;\n}\n```\n\n**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:**\n```javascript\nasync function getData() {\n    const response = await fetch("https://api.example.com/data");\n    const data = await response.json();\n    return data;\n}\n```',
            'html': 'HTML ‚Äî —è–∑—ã–∫ —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü.\n\n**–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**\n```html\n<!DOCTYPE html>\n<html lang="ru">\n<head>\n    <meta charset="UTF-8">\n    <title>–ú–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>\n</head>\n<body>\n    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>\n    <p>–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç.</p>\n</body>\n</html>\n```'
        };

        function findAnswer(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const [key, value] of Object.entries(knowledgeBase)) {
                if (lowerMessage.includes(key)) {
                    return value;
                }
            }
            
            if (lowerMessage.includes('–ø—Ä–∏–≤–µ—Ç')) {
                return '–ü—Ä–∏–≤–µ—Ç! üëã –Ø —Ç–≤–æ–π AI –ø–æ–º–æ—â–Ω–∏–∫. –°–ø—Ä–∞—à–∏–≤–∞–π –æ Python, JavaScript, HTML/CSS, React, Git, API –∏ –¥—Ä—É–≥–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö. –Ø –¥–∞–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞! üöÄ';
            }
            
            if (lowerMessage.includes('–∫–∞–∫ –¥–µ–ª–∞') || lowerMessage.includes('–∫–∞–∫ —Ç—ã')) {
                return '–û—Ç–ª–∏—á–Ω–æ! üòä –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é. –ß—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?';
            }
            
            if (lowerMessage.includes('—Å–ø–∞—Å–∏–±–æ')) {
                return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üôè –†–∞–¥ –±—ã–ª –ø–æ–º–æ—á—å. –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—â–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π! üí™';
            }
            
            return '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! ü§î –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ –Ω–∞—à–µ–ª —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ —Å–≤–æ–µ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ù–æ —è –∑–Ω–∞—é –º–Ω–æ–≥–æ –æ: Python, JavaScript, HTML/CSS, React, Git –∏ API. –°–ø—Ä–∞—à–∏–≤–∞–π –æ–± —ç—Ç–æ–º! üí°';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        imageBtn.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    selectedImage = event.target.result;
                    const base64 = event.target.result.split(',')[1];
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    const message = chatInput.value.trim() || '–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                    addMessage(message, true, selectedImage);
                    conversationHistory.push({ role: 'user', content: message });
                    
                    chatInput.value = '';
                    chatInput.style.height = 'auto';
                    sendBtn.disabled = true;
                    
                    showTypingIndicator();
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±—ç–∫–µ–Ω–¥ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
                    if (isBackendConnected) {
                        sendToBackend(message, base64).then(response => {
                            removeTypingIndicator();
                            if (response) {
                                conversationHistory.push({ role: 'assistant', content: response });
                                addMessage(response, false);
                            } else {
                                addMessage('–ò–∑–≤–∏–Ω–∏, –Ω–µ —Å–º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.', false);
                            }
                            sendBtn.disabled = false;
                            chatInput.focus();
                        });
                    } else {
                        removeTypingIndicator();
                        const answer = '–Ø –≤–∏–∂—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ! –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ —Ä–µ–∂–∏–º–µ –æ—Ñ—Ñ–ª–∞–π–Ω–∞ —è –Ω–µ –º–æ–≥—É –µ–≥–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–¥–∫–ª—é—á–∏ –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞! üì∏';
                        conversationHistory.push({ role: 'assistant', content: answer });
                        addMessage(answer, false);
                        sendBtn.disabled = false;
                        chatInput.focus();
                    }
                    
                    selectedImage = null;
                };
                reader.readAsDataURL(file);
            }
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            addMessage(message, true);
            conversationHistory.push({ role: 'user', content: message });
            
            chatInput.value = '';
            chatInput.style.height = 'auto';
            sendBtn.disabled = true;
            
            showTypingIndicator();
            
            if (isBackendConnected) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –±—ç–∫–µ–Ω–¥
                const response = await sendToBackend(message, null);
                removeTypingIndicator();
                
                if (response) {
                    conversationHistory.push({ role: 'assistant', content: response });
                    addMessage(response, false);
                } else {
                    const fallbackAnswer = findAnswer(message);
                    conversationHistory.push({ role: 'assistant', content: fallbackAnswer });
                    addMessage(fallbackAnswer, false);
                }
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
                setTimeout(() => {
                    removeTypingIndicator();
                    const answer = findAnswer(message);
                    conversationHistory.push({ role: 'assistant', content: answer });
                    addMessage(answer, false);
                    sendBtn.disabled = false;
                    chatInput.focus();
                }, 800);
                return;
            }
            
            sendBtn.disabled = false;
            chatInput.focus();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            createParticles();
            checkBackendConnection();
            chatInput.focus();
        });
    </script>
</body>
</html>
